<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>watatawa Software</title>
  <link rel="icon" href="icon.png" type="image/x-icon">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="ページの説明">
  <meta name="keywords" content="ページのキーワードA,B,C">
  <link rel="stylesheet" href="index.css">
</head>
<style>
  input {
    width: 15em;
    height: 1.4em;
}

body {
  background-color: rgb(248, 249, 230);

}

#text {
    background: linear-gradient(to bottom, #ffffff, #ffffff);
}


details {
  border: 1px solid #aaa;
  border-radius: 4px;
  padding: 0.5em 0.5em 0;
}

summary {
  font-weight: bold;
  margin: -0.5em -0.5em 0;
  padding: 0.5em;
}

details[open] {
  padding: 0.5em;
}

details[open] summary {
  border-bottom: 1px solid #aaa;
  margin-bottom: 0.5em;
}

h3{
  color: rgb(95, 95, 95);
}
 
 

</style>
<body>
  <div id="outer">
    <header>
      <div id="header-inner">
        <h1>watatawa Software</h1>
        <a href="index.html">トップページ</a> ｜ 
        <a href="market.html">マーケット【ガフ市】</a> ｜ 
        <a href="download.html">ダウンロード</a> ｜ 
        <a href="post.html">掲示板</a> ｜  
        <a href="guff.html">ガフ札情報</a> ｜ 
        <a href="guffimage.html">ガフの写真集</a> ｜ 
        <a href="chat.html">チャット</a>｜ 
        <a href="social.html">ソーシャル</a>
      </div>
    </header>

    <main>
      <div id="text">
        <br>
        <br>
        <h2>トップページ</h2>
        <label>言語：</label>
        <select id="language">
          <option value="japanese">日本語</option>
        </select>

        <label>ジャンル：</label>
        <select id="genre" onchange="loadGenreData()">
          <option value="すべて">すべて</option>
          <option value="ウェブサイト">ウェブサイト</option>
          <option value="掲示板スレッド">掲示板スレッド</option>
        </select>
　
        <input type="text" id="searchInput" placeholder="キーワードを入力">
        <button onclick="searchFiles()">検索　　</button>
        <div id="results"></div>

        <hr>
        <p>わたたわのホームページへようこそ！</p>
        <p>初めての方は利用規約でも読んでましょう！➡<a href="riyoukiyaku.html">読んで！</a></p>
        <p>バグや不明な点はお問い合わせフォームで聞いてね！</p>
     <details>
  <summary>詳細</summary>
隠れツツミ
</details>
<h3>各サービスの利用方法</h3>
        <p>まだアカウントを持っていない方は<a href="create.html">作成</a>しましょう</p>
        <h4>掲示板の利用方法</h4>
        <p>まず<a href="post.html">掲示板</a>へアクセス</p>
        <p>名前は卑猥なものでなければなんでもいいです。なりすまし防止のためトリップは名前以外のものに設定しておいてください。スレッドは作成したのち
          展開ボタンを押して投稿しましょう（わかりやすいため）他のスレッドも同様です。
        </p>
        <h4>チャットの利用方法</h4>
        <p>まず<a href="chat.html">掲示板</a>へアクセス</p>
        <p>作成したアカウントでサインインします。するとようこそと歓迎するアカウントが出迎えてくれます。ほかの人と連絡を取るにはお互いにニックネームを
          追加する必要があります。でなければ相手に一切の通知が行きません（メッセージ自体はサーバーに保存されており追加すると互いに表示されます。画像の送信は
          可能ですがファイル名が日本語だとなぜか送れません。）
        </p>
                <h4>ソーシャルの利用方法</h4>
        <p>まず<a href="social.html">ソーシャル</a>へアクセス</p>
        <p>サインインします。すると3D空間が出現します。謎の構造物がある以外には特に機能はありません。ほかの参加者は3Dモデルで表示され上にチャットの
          ニックネームと同じユーザー名が表示されます。理論上は何人でも入れる設計なのでぜひ楽しんでください
        </p>
<hr>
<h3>話題のニュース</h3>
<video src="guff.mp4" controls width="300" height="200"></video>
<p>このガフ可愛すぎやろ</p>
<hr>

<h3>互換性等に関する警告</h3>
<h4>対応ブラウザー</h4>
<p>本ウェブぺージは暗号化された通信方式(https)を利用しています。そのためインターネットエクスプローラー (IE) 6.0などの極端に古いバージョンのブラウザで
  開こうとすると対応していないため開けない場合があります。また本ウェブサイトを最大限に利用する際、できる限り新しいブラウザで実行してください。
  JavaScriptが正常に機能しない場合があります。
</p>

<hr>
        <h3>お知らせ</h3>
        <h4>新しく1:1でチャットができるようになりました。</h4>
        <h4>掲示板のUIを変更</h4>
      <details> <summary><strong>お知らせの詳細</strong></summary>
<ul>
  <il>ソーシャルで構造物を追加</il>
  <hr>
  <il>トップページのデザインを変更</il>
  <hr>
  <li>チャット　着信出来ないバグを修正</li>
  <hr>
  <li>チャットのULを一新</li>
  <hr>
  <li>スレッド検索機能を追加</li>
</ul>
</details>
               <p>おしらせ絶対ページの上部に設置すべきだっただろ。速報性皆無で草。</p>
               <p>自分に悪口言ってて草</p>
        <img src="okok.jpg" width="184" height="31" alt="自由利用マーク">
        <img src="ie.gif" width="90" height="70" alt="ie">
      </div>
    </main>

    <aside>
      <div class="side-title">menu</div>
      <a href="otoiawase.html">お問い合わせフォーム</a><br>
      <a href="riyoukiyaku.html">利用規約</a>
    </aside>

    <footer>all rights reserved ©watatawa Software 2021~2025</footer>
  </div>

  <!-- 🔧 JavaScript を body の最後にまとめて -->
  <script>
    let files = [];

    function loadGenreData() {
      const genre = document.getElementById('genre').value;
      const resultsDiv = document.getElementById('results');
      resultsDiv.innerHTML = '';

      if (!genre) {
        files = [];
        resultsDiv.innerHTML = '<p>すべてのジャンルを表示します。</p>';
        return;
      }

      fetch(`${genre}.json`)
        .then(res => res.json())
        .then(data => {
          files = data;
          resultsDiv.innerHTML = `<p>検索対象：${genre}</p>`;
        })
        .catch(() => {
          resultsDiv.innerHTML = `<p>${genre}.json の読み込みに失敗しました。</p>`;
        });
    }

    function normalize(str) {
  return str.normalize("NFKC").toLowerCase().replace(/\s+/g, '');
}


   function searchFiles() {
  const keyword = document.getElementById('searchInput').value.trim();
  const resultsDiv = document.getElementById('results');
  resultsDiv.innerHTML = '';

  if (!files.length) {
    resultsDiv.innerHTML = '<p>ジャンルを選択してください</p>';
    return;
  }

  if (!keyword) {
    resultsDiv.innerHTML = '<p>キーワードが入力されていません。</p>';
    return;
  }

  const firstChar = normalize(keyword).charAt(0);
  const matched = [];

  files.forEach(f => {
    const title = normalize(f.title);
    const file = normalize(f.file);

    // 文字列を空白などで分割して、各単語の先頭と一致するかチェック
    const titleWords = title.split(/[\s　・,、。！？]/);
    const fileWords = file.split(/[\s　・,、。！？]/);

    const titleMatch = titleWords.some(word => word.startsWith(firstChar));
    const fileMatch = fileWords.some(word => word.startsWith(firstChar));

    if (titleMatch || fileMatch) {
      matched.push(f);
    }
  });

  if (matched.length === 0) {
    resultsDiv.innerHTML = '<p>見つかりませんでした</p>';
  } else {
    matched.forEach(f => {
      const block = document.createElement('div');
      block.innerHTML = `
        <strong>${f.title}</strong><br>
        <a href="${f.file}">${f.file}</a>
        <hr>
      `;
      resultsDiv.appendChild(block);
    });
  }
}



    window.addEventListener('DOMContentLoaded', () => {
    loadGenreData(); // 選択されている value="files" を読み込む
  });
  </script>
</body>
</html>
