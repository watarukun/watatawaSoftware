<!DOCTYPE html>
<html lang="ja">
<head>
<link rel="icon" href="icon.png" type="image/x-icon">
<meta charset="UTF-8">
<title>掲示板</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="ページの説明">
<meta name="keywords" content="ページのキーワードA,B,C">
<link rel="stylesheet" href="index.css">
</head>
<body>
<div id="outer">
<header><div id="header-inner"><h1>watatawa Software</h1><a href="index.html">トップページ</a>   <a href="download.html">ダウンロード</a>   <a href="post.html">掲示板</a>   <a href="guff.html">ガフ札情報</a>
</div></header>
<main><div id="text">
<h2>掲示板</h2>

<form id="form">
    <input id="message" placeholder="メッセージを入力" required>
    <button type="submit">投稿</button>
  </form>

  <ul id="messages"></ul>

  <script>
    const SUPABASE_URL = 'https://ftuamjkicezhtxfyujob.supabase.co';
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZ0dWFtamtpY2V6aHR4Znl1am9iIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE5ODk0NDcsImV4cCI6MjA2NzU2NTQ0N30.fu_4lkKnjeAeJTUGwc6KTVCrN2mqberTuGfLOwaWSeA'; // ←あなたのanonキー

    const headers = {
      'Content-Type': 'application/json',
      'apikey': SUPABASE_KEY,
      'Authorization': 'Bearer ' + SUPABASE_KEY,
    };

    async function fetchMessages() {
      const res = await fetch(`${SUPABASE_URL}/rest/v1/messages?select=text,created_at&order=created_at.desc`, { headers });
      const data = await res.json();
      const ul = document.getElementById('messages');
      ul.innerHTML = '';
      data.forEach(msg => {
        const li = document.createElement('li');
        li.textContent = `[${new Date(msg.created_at).toLocaleString()}] ${msg.text}`;
        ul.appendChild(li);
      });
    }

    document.getElementById('form').addEventListener('submit', async e => {
      e.preventDefault();
      const input = document.getElementById('message');
      const message = input.value.trim();
      if (!message) return;

      await fetch(`${SUPABASE_URL}/rest/v1/messages`, {
        method: 'POST',
        headers,
        body: JSON.stringify([{ text: message }]),
      });

      input.value = '';
      fetchMessages();
    });

    fetchMessages();
  </script>

</div>
</main>
<aside>
<div class="side-title">menu</div>
<div class="side">
<ul>
 

</ul>
</div>
</aside>
<footer>all rights reserved ©watatawa Software 2021~2025</footer>